<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  </head>

  <body style="background-color:#010613">
    <div class="topnav" style="padding-right: 25px">
      <a href="home.html">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
          class="bi bi-house" viewBox="0 0 16 16">
          <path
            d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293zM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5z"/>
        </svg>
      </a>
      <a href="simulation.html">Simulation</a>
      <a class="active" href="gambling.html">Gambling</a>
      <a href="warning.html">Warning</a>
    </div>

    <div class="gamblingslider" style="color: white;">
      <label for="range2" class="form-label">0</label>
      <input type="range" class="form-range" min="0" max="50" id="range2">
      <label for="range2" class="form-label">50</label>
      <p style="justify-self: center;">Value: <span id="demo"></span></p>
    </div>

    <div style="justify-self: center; display: grid; grid-template-columns: auto auto; gap: 2rem; " class="buttonsplit">
      <!-- Left Column -->
      <div style="display: grid; gap: 1rem; padding-top: 100px;">
        <!-- Team 1 -->
        <div class="dropdown" style="width: 40vw;">
          <button onclick="toggleDropdown('dropdownOne')" class="dropbtn">
            Select Team 1
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
              class="bi bi-caret-down" viewBox="0 0 16 16">
              <path
                d="M3.204 5h9.592L8 10.481zm-.753.659 4.796 5.48a1 1 0 0 0 1.506 0l4.796-5.48c.566-.647.106-1.659-.753-1.659H3.204a1 1 0 0 0-.753 1.659" />
            </svg>
          </button>
          <div id="dropdownOne" class="dropdown-content"></div>
        </div>
        
        <!-- Team 3 -->
        <div class="dropdown" style="padding-top: 150px;">
          <button onclick="toggleDropdown('dropdownThree')" class="dropbtn">
            Select Player
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
              class="bi bi-caret-down" viewBox="0 0 16 16">
              <path
                d="M3.204 5h9.592L8 10.481zm-.753.659 4.796 5.48a1 1 0 0 0 1.506 0l4.796-5.48c.566-.647.106-1.659-.753-1.659H3.204a1 1 0 0 0-.753 1.659" />
            </svg>
          </button>
          <div id="dropdownThree" class="dropdown-content"></div>
        </div>
      </div>

      <!-- Right Column -->
      <div style="display: grid; gap: 1rem;">
        <div class="dropdown" style="align-self: start; padding-top: 100px;">
          <button onclick="toggleDropdown('dropdownTwo')" class="dropbtn">
            Select Team 2
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
              class="bi bi-caret-down" viewBox="0 0 16 16">
              <path
                d="M3.204 5h9.592L8 10.481zm-.753.659 4.796 5.48a1 1 0 0 0 1.506 0l4.796-5.48c.566-.647.106-1.659-.753-1.659H3.204a1 1 0 0 0-.753 1.659" />
            </svg>
          </button>
          <div id="dropdownTwo" class="dropdown-content"></div>
        </div>

        <div class="dropdown" style="padding-top: 150px;">
          <button onclick="toggleDropdown('dropdownFour')" class="dropbtn">
            Select Player
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
              class="bi bi-caret-down" viewBox="0 0 16 16">
              <path
                d="M3.204 5h9.592L8 10.481zm-.753.659 4.796 5.48a1 1 0 0 0 1.506 0l4.796-5.48c.566-.647.106-1.659-.753-1.659H3.204a1 1 0 0 0-.753 1.659" />
            </svg>
          </button>
          <div id="dropdownFour" class="dropdown-content"></div>
        </div>
      </div>

      
    </div>
          <div class="" style="justify-self: center; padding-top: 150px;">
              <a  href="simulation.html">
                <button onclick="" class="simbtn">
                Run Simulation
              </button></a>
            </div>
          </div>

    <script>
      const teamOneButton = document.querySelector("button[onclick*='dropdownOne']");
      const playerOneButton = document.querySelector("button[onclick*='dropdownThree']");
      const teamTwoButton = document.querySelector("button[onclick*='dropdownTwo']");
      const playerTwoButton = document.querySelector("button[onclick*='dropdownFour']");

      let players = []; // CSV data
      let selectedTeamOne = null;
      let selectedTeamTwo = null;

      fetch('teams.json')
        .then(res => res.json())
        .then(data => {
            const uniqueTeams = [...new Set(data.map(item => item.TeamName))];
            populateDropdown('dropdownOne', uniqueTeams, team => {
                selectedTeamOne = team;
                selectTeamOne(team);
            });
            populateDropdown('dropdownTwo', uniqueTeams, team => {
                selectedTeamTwo = team;
                selectTeamTwo(team);
            });
        })
        .catch(err => console.error('Error loading teams.json:', err));

      Papa.parse("API Output-Pitchers.csv", {
          download: true,
          header: true,
          complete: function(results) {
              players = results.data;

              if (selectedTeamOne) updatePlayerDropdown('dropdownThree', selectedTeamOne, selectPlayerOne);
              if (selectedTeamTwo) updatePlayerDropdown('dropdownFour', selectedTeamTwo, selectPlayerTwo);
          }
      });

      function populateDropdown(dropdownId, items, callback) {
        const container = document.getElementById(dropdownId);
        container.innerHTML = ""; // clear previous content

        items.forEach(item => {
            const btn = document.createElement("button");
            btn.textContent = item;
            btn.onclick = () => {
                callback(item);
                container.classList.remove("show"); // close dropdown after selection
            };
            container.appendChild(btn);
        });
      }
      // --- Team selection ---
      function selectTeamOne(team) {
          document.getElementById('dropdownOne').classList.remove('show');
          teamOneButton.innerHTML = `Team 1: ${team}`;
          localStorage.setItem('team1', team);

          updatePlayerDropdown('dropdownThree', team, selectPlayerOne);
          playerOneButton.innerHTML = "Select Player";
      }

      function selectTeamTwo(team) {
          document.getElementById('dropdownTwo').classList.remove('show');
          teamTwoButton.innerHTML = `Team 2: ${team}`;
          localStorage.setItem('team2', team);

          updatePlayerDropdown('dropdownFour', team, selectPlayerTwo);
          playerTwoButton.innerHTML = "Select Player";
      }

      // --- Player selection ---
      function selectPlayerOne(team, player) {
          document.getElementById('dropdownThree').classList.remove('show');
          playerOneButton.innerHTML = `Player: ${player}`;
          localStorage.setItem('player1', player);
          localStorage.setItem('home_pitcher', player);
      }

      function selectPlayerTwo(team, player) {
          document.getElementById('dropdownFour').classList.remove('show');
          playerTwoButton.innerHTML = `Player: ${player}`;
          localStorage.setItem('player2', player);
          localStorage.setItem('away_pitcher', player);
      }

      // --- Populate player dropdown for selected team ---
      function updatePlayerDropdown(dropdownId, team, callback) {
        if (players.length === 0) return; // wait until CSV loads

        // Filter players by TeamName
        const playerList = players
            .filter(p => p.TeamName === team)
            .map(p => p.PlayerName);

        if (playerList.length === 0) {
            playerList.push("No players found");
        }

        populateDropdown(dropdownId, playerList, player => callback(team, player));
      }


      // --- Dropdown toggle ---
      function toggleDropdown(dropdownId) {
        const el = document.getElementById(dropdownId).classList.toggle("show");
      }

      // Close dropdowns when clicking outside
      window.onclick = function(event) {
          if (!event.target.matches('.dropbtn') && !event.target.closest('.dropdown')) {
              document.querySelectorAll(".dropdown-content").forEach(el => el.classList.remove("show"));
          }
      };

      // --- Slider ---
      var slider = document.getElementById("range2");
      var output = document.getElementById("demo");
      output.innerHTML = slider.value;

      slider.oninput = function() {
          output.innerHTML = this.value;
      }
    </script>

  </body>
</html>
